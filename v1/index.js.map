{"version":3,"sources":["intro.js","expr.js","html.js","main.js"],"names":["$","makeSymbol","s","type","val","makeNumber","v","parseInt","maxSafeInt","makeSum","ss","acc","hasNan","hasInf","subs","forEach","push","length","makeProduct","handleNumber","unshift","makeFraction","num","den","gcd","a","b","leadFactor","numden","replaceLeadFactor","lead","slice","np","dp","n","d","g","makeDefinition","lhs","rhs","parseExpression","str","expr","stripParentheses","charAt","match","split","map","root","substituteIntoExpression","rec","convertExpressionToHtml","inner","e","toFixed","value","precision","power","Math","pow","String","round","formatFloat","toExponential","replace","isAtom","isExact","every","defJoin","vis","join","numdenHtml","makeEmptyFormulaHtml","formula","each","wikipedia","block","url","haveToSwap","dir","i","rcOrd","rcDir","expandTable","addCell","callOrd","insertNormal","insertSwapped","makeCell","j","cellData","expandData","cell","html","attr","addCol","tbodyNode","children","oldRow","this","newCell","append","eq","before","addRow","newRow","oldCell","isExpanded","tableNode","find","text","off","click","contractTable","updateFormulas","removeCol","remove","removeRow","after","swapChildren","node","c1","c2","drawSwapIcon","angle","drawDiagram","hr","h","vr","tickPaths","lobe","close","textCoords","installDiagrammEventHandlers","higherFormulaNodes","lowerFormulaNodes","hover","addClass","removeAttr","removeClass","updateDiagram","replaceWith","term","termInputs","termValues","TPR","TP","FN","FNR","FPR","FP","TN","TNR","c2p","prev","on","td","fi","validity","valid"],"mappings":"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","file":"index.js","sourcesContent":["$(function(){\r\n","function makeSymbol(s) {\r\n\treturn {type:'sym',val:s};\r\n\t// technically need two types of symbols:\r\n\t//   finite x: 0*x can be transformed into 0\r\n\t//   possibly infinite x: 0*x has to be kept\r\n\t// currently playing safe and considering all symbols possibly infinite\r\n\t// also all symbols are considered nonnegative, otherwise will need two more types\r\n}\r\n\r\n// accepts string, not number - this is violated in code below\r\nfunction makeNumber(s) {\r\n\t//if (typeof(s)=='string' && s.indexOf('e')>=0) {\r\n\t//\treturn {type:'float',val:parseFloat(s)};\r\n\t//}\r\n\tvar v=parseInt(s);\r\n\t//var maxSafeInt=9007199254740991; // Number.MAX_SAFE_INTEGER, see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/MAX_SAFE_INTEGER\r\n\tvar maxSafeInt=1000000000000; // use floats for numbers that are too large\r\n\tif (v<=maxSafeInt) {\r\n\t\treturn {type:'int',val:v};\r\n\t} else {\r\n\t\treturn {type:'float',val:v};\r\n\t}\r\n}\r\n\r\nfunction makeSum(ss) {\r\n\tvar acc=makeNumber(0);\r\n\tvar hasNan=false;\r\n\tvar hasInf=false;\r\n\tvar subs=[];\r\n\t// TODO flatten sum? - don't need it here\r\n\tss.forEach(function(s){\r\n\t\tif (s.type=='int') {\r\n\t\t\tacc.val+=s.val; // TODO check if safe int\r\n\t\t} else if (s.type=='float') {\r\n\t\t\tacc.val+=s.val;\r\n\t\t\tacc.type='float';\r\n\t\t} else if (s.type=='nan') {\r\n\t\t\thasNan=true;\r\n\t\t} else if (s.type=='inf') {\r\n\t\t\thasInf=true;\r\n\t\t} else {\r\n\t\t\tsubs.push(s);\r\n\t\t}\r\n\t});\r\n\tif (hasNan) {\r\n\t\treturn {type:'nan'};\r\n\t} else if (hasInf) {\r\n\t\treturn {type:'inf'};\r\n\t}\r\n\tif (acc.val) {\r\n\t\tsubs.push(acc);\r\n\t}\r\n\tif (subs.length>1) {\r\n\t\treturn {type:'sum',subs:subs};\r\n\t} else if (subs.length==1) {\r\n\t\treturn subs[0];\r\n\t} else {\r\n\t\treturn makeNumber(0);\r\n\t}\r\n}\r\n\r\nfunction makeProduct(ss) {\r\n\tvar acc=makeNumber(1);\r\n\tvar hasNan=false;\r\n\tvar hasInf=false;\r\n\tvar subs=[];\r\n\tfunction handleNumber(s) {\r\n\t\tif (s.type=='int') {\r\n\t\t\tacc.val*=s.val; // TODO check if safe int\r\n\t\t\tif (s.val==0) acc.type='int';\r\n\t\t\treturn true;\r\n\t\t} else if (s.type=='float') {\r\n\t\t\tif (!(acc.type=='int' && acc.val==0)) {\r\n\t\t\t\tacc.val*=s.val;\r\n\t\t\t\tacc.type='float';\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\tss.forEach(function(s){\r\n\t\tif (handleNumber(s)) {\r\n\t\t\t// done by handleNumber(s)\r\n\t\t} else if (s.type=='prod') {\r\n\t\t\ts.subs.forEach(function(s){\r\n\t\t\t\tif (handleNumber(s)) {\r\n\t\t\t\t\t// done by handleNumber(s)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsubs.push(s);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else if (s.type=='nan') {\r\n\t\t\thasNan=true;\r\n\t\t} else if (s.type=='inf') {\r\n\t\t\thasInf=true;\r\n\t\t} else {\r\n\t\t\tsubs.push(s);\r\n\t\t}\r\n\t});\r\n\tif (hasNan || (acc.val==0 && hasInf)) {\r\n\t\treturn {type:'nan'};\r\n\t}\r\n\tif (acc.val!=1 && !hasInf) {\r\n\t\tsubs.unshift(acc);\r\n\t}\r\n\tif (hasInf) {\r\n\t\tsubs.unshift({type:'inf'});\r\n\t}\r\n\tif (subs.length>1) {\r\n\t\treturn {type:'prod',subs:subs}; // number can only be a first subexpression\r\n\t} else if (subs.length==1) {\r\n\t\treturn subs[0];\r\n\t} else {\r\n\t\treturn makeNumber(1);\r\n\t}\r\n}\r\n\r\nfunction makeFraction(num,den) {\r\n\tfunction gcd(a,b) {\r\n\t\tif (!b) {\r\n\t\t\treturn a;\r\n\t\t} else {\r\n\t\t\treturn gcd(b,a%b);\r\n\t\t}\r\n\t};\r\n\t(function(){\r\n\t\tvar np=makeProduct([]);\r\n\t\tvar dp=makeProduct([]);\r\n\t\tif (num.type=='frac') {\r\n\t\t\tnp=makeProduct([np,num.num]);\r\n\t\t\tdp=makeProduct([dp,num.den]);\r\n\t\t} else {\r\n\t\t\tnp=makeProduct([np,num]);\r\n\t\t}\r\n\t\tif (den.type=='frac') {\r\n\t\t\tnp=makeProduct([np,den.den]);\r\n\t\t\tdp=makeProduct([dp,den.num]);\r\n\t\t} else {\r\n\t\t\tdp=makeProduct([dp,den]);\r\n\t\t}\r\n\t\tnum=np;\r\n\t\tden=dp;\r\n\t})();\r\n\tfunction leadFactor(numden) {\r\n\t\treturn numden.type=='prod'?numden.subs[0]:numden;\r\n\t}\r\n\tfunction replaceLeadFactor(numden,lead) {\r\n\t\tif (numden.type=='prod') {\r\n\t\t\treturn makeProduct([lead,makeProduct(numden.subs.slice(1))]);\r\n\t\t} else {\r\n\t\t\treturn lead;\r\n\t\t}\r\n\t}\r\n\t// gcd simplification\r\n\t(function(){\r\n\t\tvar n=leadFactor(num);\r\n\t\tvar d=leadFactor(den);\r\n\t\tif (n.type=='int' && d.type=='int' && n.val!=0 && d.val!=0) {\r\n\t\t\tvar g=gcd(n.val,d.val);\r\n\t\t\tnum=replaceLeadFactor(num,makeNumber(n.val/g));\r\n\t\t\tden=replaceLeadFactor(den,makeNumber(d.val/g));\r\n\t\t}\r\n\t})();\r\n\t// first try to move stuff to numerator when makes sense\r\n\t(function(){\r\n\t\tvar n=leadFactor(num);\r\n\t\tvar d=leadFactor(den);\r\n\t\tif (n.type=='int' && n.val==0) {\r\n\t\t\tif ((d.type=='int'||d.type=='float') && d.val!=0) {\r\n\t\t\t\tden=replaceLeadFactor(den,makeNumber(1));\r\n\t\t\t}\r\n\t\t} else if (n.type=='inf') {\r\n\t\t\tif (d.type=='int'||d.type=='float') {\r\n\t\t\t\tden=replaceLeadFactor(den,makeNumber(1));\r\n\t\t\t}\r\n\t\t} else if (n.type=='float') {\r\n\t\t\tif ((d.type=='int'||d.type=='float') && d.val!=0) {\r\n\t\t\t\tnum=replaceLeadFactor(num,{type:'float',val:n.val/d.val});\r\n\t\t\t\tden=replaceLeadFactor(den,makeNumber(1));\r\n\t\t\t}\r\n\t\t}\r\n\t})();\r\n\t// then clean up denominator\r\n\t(function(){\r\n\t\tvar d=leadFactor(den);\r\n\t\tif (d.type=='int' && d.val==0) {\r\n\t\t\tnum=makeProduct([{type:'inf'},num]);\r\n\t\t\tden=replaceLeadFactor(den,makeNumber(1));\r\n\t\t} else if (d.type=='inf') {\r\n\t\t\tnum=makeProduct([makeNumber(0),num]);\r\n\t\t\tden=replaceLeadFactor(den,makeNumber(1));\r\n\t\t} else if (d.type=='float') {\r\n\t\t\tnum=makeProduct([{type:'float',val:1/d.val},num]);\r\n\t\t\tden=replaceLeadFactor(den,makeNumber(1));\r\n\t\t}\r\n\t})();\r\n\tif (num.type=='nan' || den.type=='nan') {\r\n\t\treturn {type:'nan'};\r\n\t}\r\n\tif (den.type=='int' && den.val==1) {\r\n\t\treturn num;\r\n\t}\r\n\treturn {type:'frac',num:num,den:den};\r\n}\r\n\r\nfunction makeDefinition(lhs,rhs) {\r\n\treturn {type:'def',lhs:lhs,rhs:rhs};\r\n}\r\n\r\nfunction parseExpression(str) {\r\n\tfunction expr(str) {\r\n\t\tfunction stripParentheses(str) {\r\n\t\t\tif (str.charAt(0)=='(') {\r\n\t\t\t\treturn str.slice(1,-1);\r\n\t\t\t} else {\r\n\t\t\t\treturn str;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar match=str.match(/(\\(.*\\)|\\w+)\\/(\\(.*\\)|\\w+)/);\r\n\t\tif (match) {\r\n\t\t\treturn makeFraction(\r\n\t\t\t\texpr(stripParentheses(match[1])),\r\n\t\t\t\texpr(stripParentheses(match[2]))\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\treturn makeSum(\r\n\t\t\t\tstr.split('+').map(function(s){\r\n\t\t\t\t\treturn makeSymbol(s);\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\tfunction root(str) {\r\n\t\tvar match=str.match(/^(.*)=(.*)$/);\r\n\t\tif (match) {\r\n\t\t\treturn makeDefinition(\r\n\t\t\t\tmakeSymbol(match[1]),\r\n\t\t\t\texpr(match[2])\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\treturn expr(str);\r\n\t\t}\r\n\t}\r\n\treturn root(str);\r\n}\r\n\r\nfunction substituteIntoExpression(expr,subs) { // FIXME both subexpressions and substitutions are called 'subs'\r\n\tfunction rec(expr) {\r\n\t\treturn substituteIntoExpression(expr,subs);\r\n\t}\r\n\tif (expr.type=='sym') {\r\n\t\tif (expr.val in subs) {\r\n\t\t\treturn subs[expr.val];\r\n\t\t} else {\r\n\t\t\treturn expr;\r\n\t\t}\r\n\t} else if (expr.type=='sum') {\r\n\t\treturn makeSum(expr.subs.map(rec));\r\n\t} else if (expr.type=='prod') {\r\n\t\treturn makeProduct(expr.subs.map(rec));\r\n\t} else if (expr.type=='frac') {\r\n\t\treturn makeFraction(rec(expr.num),rec(expr.den));\r\n\t} else if (expr.type=='def') {\r\n\t\treturn makeDefinition(expr.lhs,rec(expr.rhs)); // don't substitute in lhs\r\n\t} else {\r\n\t\treturn expr;\r\n\t}\r\n}\r\n","function convertExpressionToHtml(expr,inner) {\r\n\tfunction rec(e) {\r\n\t\treturn convertExpressionToHtml(e,true);\r\n\t}\r\n\tfunction toFixed(value) { // http://stackoverflow.com/a/661757\r\n\t\tvar precision=6;\r\n\t\tvar power=Math.pow(10,precision||0);\r\n\t\treturn String(Math.round(value*power)/power);\r\n\t}\r\n\tfunction formatFloat(value) {\r\n\t\tvar ss=value.toExponential().split(/e\\+?/);\r\n\t\tvar e=parseInt(ss[1]);\r\n\t\tif (e<-2 || e>7) {\r\n\t\t\treturn toFixed(ss[0])+'·10<sup>'+ss[1].replace('-','−')+'</sup>';\r\n\t\t} else {\r\n\t\t\treturn toFixed(value);\r\n\t\t}\r\n\t}\r\n\tfunction isAtom(e) {\r\n\t\treturn e.type=='int' || e.type=='float' || e.type=='sym';\r\n\t}\r\n\tfunction isExact(e) {\r\n\t\tif (e.type=='float') {\r\n\t\t\treturn false;\r\n\t\t} else if (e.type=='sum' || e.type=='prod') {\r\n\t\t\treturn e.subs.every(isExact);\r\n\t\t} else if (e.type=='frac') {\r\n\t\t\treturn isExact(e.num)&&isExact(e.den);\r\n\t\t} else {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\tfunction defJoin(rhs) {\r\n\t\tif (rhs.type=='nan') {\r\n\t\t\treturn ' is ';\r\n\t\t} else if (isExact(rhs)) {\r\n\t\t\treturn ' = ';\r\n\t\t} else {\r\n\t\t\treturn ' ≈ ';\r\n\t\t}\r\n\t}\r\n\tif (expr.type=='int') {\r\n\t\treturn String(expr.val);\r\n\t} else if (expr.type=='float') {\r\n\t\treturn formatFloat(expr.val);\r\n\t} else if (expr.type=='inf') {\r\n\t\treturn '∞';\r\n\t} else if (expr.type=='nan') {\r\n\t\treturn 'undefined';\r\n\t} else if (expr.type=='sym') {\r\n\t\tvar vis=expr.val;\r\n\t\tif (expr.val=='PLR') {\r\n\t\t\tvis=\"LR<sub>+</sub>\";\r\n\t\t} else if (expr.val=='NLR') {\r\n\t\t\tvis=\"LR<sub>−</sub>\";\r\n\t\t}\r\n\t\treturn \"<span class='term' data-term='\"+expr.val+\"'>\"+vis+\"</span>\";\r\n\t} else if (expr.type=='sum') {\r\n\t\treturn expr.subs.map(rec).join('+');\r\n\t} else if (expr.type=='prod') {\r\n\t\treturn expr.subs.map(function(e){\r\n\t\t\tif (isAtom(e)) {\r\n\t\t\t\treturn rec(e);\r\n\t\t\t} else {\r\n\t\t\t\treturn '('+rec(e)+')'; // TODO span='aux' for e.type=='frac' (but not for e.type=='sum')\r\n\t\t\t}\r\n\t\t}).join('·');\r\n\t} else if (expr.type=='frac') {\r\n\t\tvar numdenHtml=function(e){\r\n\t\t\tif (isAtom(e)) {\r\n\t\t\t\treturn rec(e);\r\n\t\t\t} else {\r\n\t\t\t\treturn \"<span class='aux'>(</span>\"+rec(e)+\"<span class='aux'>)</span>\";\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar s=\"<span class='sfrac'>\"+\r\n\t\t\t\"<span class='num'>\"+numdenHtml(expr.num)+\"</span>\"+\r\n\t\t\t\"<span class='aux'>/</span>\"+\r\n\t\t\t\"<span class='den'>\"+numdenHtml(expr.den)+\"</span>\"+\r\n\t\t\"</span>\";\r\n\t\tif (!inner && expr.num.type=='int' && expr.den.type=='int') {\r\n\t\t\ts+=' ≈ '+formatFloat(expr.num.val/expr.den.val);\r\n\t\t}\r\n\t\treturn s;\r\n\t} else if (expr.type=='def') {\r\n\t\treturn rec(expr.lhs)+defJoin(expr.rhs)+convertExpressionToHtml(expr.rhs,inner);\r\n\t}\r\n}\r\n\r\nfunction makeWrappedFormulaHtml(formula) {\r\n\treturn \"<div class='formula' data-formula='\"+formula+\"'>\"+convertExpressionToHtml(parseExpression(formula))+\"</div>\";\r\n}\r\n\r\nfunction makeEmptyFormulaHtml(formula) {\r\n\treturn \"<div class='formula' data-formula='\"+formula+\"' />\";\r\n}\r\n\r\n// TODO fn to output the whole table\r\n","$('table.statistics-confusion').each(function(){\r\n\tvar tableNode=$(this);\r\n\tvar tbodyNode=tableNode.children('tbody');\r\n\tvar rcDir=0; // outcome headers on top?\r\n\tvar rcOrd=[0,0]; // outcomes swapped?, conditions swapped?\r\n\tvar isExpanded=false;\r\n\t//function wikipedia(block,url) {\r\n\t//\tif (url===undefined) url=\"https://en.wikipedia.org/wiki/\"+block.replace(/ /g,'_');\r\n\tfunction wikipedia(block) {\r\n\t\turl=\"https://en.wikipedia.org/wiki/\"+block.replace(/ /g,'_');\r\n\t\treturn \"<a href='\"+url+\"'>\"+block+\"</a>\";\r\n\t}\r\n\tvar expandData=[\r\n\t\t[ // new row\r\n\t\t\t[null,makeEmptyFormulaHtml(\"(FN+TN)/(TP+FP+FN+TN)\")],\r\n\t\t\t['FNR',\"<div class='label'>\"+wikipedia(\"False negative rate\")+\"</div>\"+makeEmptyFormulaHtml(\"FNR=FN/(TP+FN)\")],\r\n\t\t\t['FPR',\"<div class='label'>\"+wikipedia(\"False positive rate\")+\"</div>\"+makeEmptyFormulaHtml(\"FPR=FP/(FP+TN)\")],\r\n\t\t\t[null,\"<div class='label'>Overall error rate</div>\"+makeEmptyFormulaHtml(\"(FP+FN)/(TP+FP+FN+TN)\")],\r\n\t\t\t[null,\"\"] // not used\r\n\t\t],[ // new col\r\n\t\t\t[null,makeEmptyFormulaHtml(\"(FP+TN)/(TP+FP+FN+TN)\")],\r\n\t\t\t['FDR',\"<div class='label'>\"+wikipedia(\"False discovery rate\")+\"</div>\"+makeEmptyFormulaHtml(\"FDR=FP/(TP+FP)\")],\r\n\t\t\t['FOR',\"<div class='label'>\"+wikipedia(\"False omission rate\")+\"</div>\"+makeEmptyFormulaHtml(\"FOR=FN/(FN+TN)\")],\r\n\t\t\t['PLR',\"<div class='label'>\"+wikipedia(\"Positive likelihood ratio\")+\"</div>\"+makeEmptyFormulaHtml(\"PLR=TPR/FPR\")],\r\n\t\t\t['NLR',\"<div class='label'>\"+wikipedia(\"Negative likelihood ratio\")+\"</div>\"+makeEmptyFormulaHtml(\"NLR=FNR/TNR\")]\r\n\t\t]\r\n\t];\r\n\tfunction haveToSwap(dir,i) {\r\n\t\tif (i==1 || i==2) {\r\n\t\t\treturn ((i-1)^rcOrd[0]^rcOrd[1])&1;\r\n\t\t} else {\r\n\t\t\treturn rcOrd[rcDir^dir]&1;\r\n\t\t}\r\n\t}\r\n\tfunction expandTable() {\r\n\t\tfunction addCell(callOrd,dir,i,insertNormal,insertSwapped) {\r\n\t\t\tfunction makeCell() {\r\n\t\t\t\tvar j=i;\r\n\t\t\t\tif ((j==1 || j==2) && rcOrd[rcDir^dir^1]) {\r\n\t\t\t\t\tj^=1^2;\r\n\t\t\t\t} else if (callOrd && (j==3 || j==4) && rcOrd[rcDir^dir^1]) {\r\n\t\t\t\t\tj^=3^4;\r\n\t\t\t\t}\r\n\t\t\t\tvar cellData=expandData[rcDir^dir][j];\r\n\t\t\t\tvar cell=$(\"<td>\").html(cellData[1]);\r\n\t\t\t\tif (cellData[0]!==null) cell.attr('data-term',cellData[0]);\r\n\t\t\t\treturn cell;\r\n\t\t\t}\r\n\t\t\tvar cell=makeCell();\r\n\t\t\tif (haveToSwap(dir,i)) {\r\n\t\t\t\tinsertSwapped(cell);\r\n\t\t\t} else {\r\n\t\t\t\tinsertNormal(cell);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction addCol(callOrd) {\r\n\t\t\ttbodyNode.children().each(function(i){\r\n\t\t\t\tvar oldRow=$(this);\r\n\t\t\t\taddCell(callOrd,1,i,function(newCell){\r\n\t\t\t\t\toldRow.append(newCell);\r\n\t\t\t\t},function(newCell){\r\n\t\t\t\t\toldRow.children().eq(-1).before(newCell);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t\tfunction addRow(callOrd) {\r\n\t\t\tvar newRow=$(\"<tr>\");\r\n\t\t\ttbodyNode.append(newRow);\r\n\t\t\ttbodyNode.children().eq(-2).children().each(function(i){\r\n\t\t\t\tvar oldCell=$(this);\r\n\t\t\t\taddCell(callOrd,0,i,function(newCell){\r\n\t\t\t\t\tnewRow.append(newCell);\r\n\t\t\t\t},function(newCell){\r\n\t\t\t\t\toldCell.before(newCell);\r\n\t\t\t\t\tnewRow.append(oldCell);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (rcDir) {\r\n\t\t\taddCol(0);\r\n\t\t\taddRow(1);\r\n\t\t} else {\r\n\t\t\taddRow(0);\r\n\t\t\taddCol(1);\r\n\t\t}\r\n\t\tisExpanded=true;\r\n\t\ttableNode.find('button.add-r, button.add-c').text('−').attr('title','contract table').off().click(contractTable);\r\n\t\tupdateFormulas();\r\n\t}\r\n\tfunction contractTable() {\r\n\t\tfunction removeCol() {\r\n\t\t\ttbodyNode.children().each(function(i){\r\n\t\t\t\tvar oldRow=$(this);\r\n\t\t\t\toldRow.children().eq(haveToSwap(1,i)?-2:-1).remove();\r\n\t\t\t});\r\n\t\t}\r\n\t\tfunction removeRow() {\r\n\t\t\tvar oldRow=tbodyNode.children().eq(-2);\r\n\t\t\tvar newRow=tbodyNode.children().eq(-1);\r\n\t\t\tnewRow.children().each(function(i){\r\n\t\t\t\tif (haveToSwap(0,i)) {\r\n\t\t\t\t\tvar oldCell=$(this);\r\n\t\t\t\t\tvar newCell=oldRow.children().eq(i);\r\n\t\t\t\t\tnewCell.after(oldCell).remove();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tnewRow.remove();\r\n\t\t}\r\n\t\tif (rcDir) {\r\n\t\t\tremoveRow();\r\n\t\t\tremoveCol();\r\n\t\t} else {\r\n\t\t\tremoveCol();\r\n\t\t\tremoveRow();\r\n\t\t}\r\n\t\tisExpanded=false;\r\n\t\ttableNode.find('button.add-r, button.add-c').text('+').attr('title','expand table').off().click(expandTable);\r\n\t}\r\n\tfunction swapChildren(node,i) {\r\n\t\tvar c1=node.children().eq(i);\r\n\t\tvar c2=node.children().eq(i+1);\r\n\t\tc1.before(c2);\r\n\t}\r\n\tfunction drawSwapIcon(angle) {\r\n\t\treturn \"<svg width='100%' height='100%' viewBox='-2 -2 4 4'>\"+\r\n\t\t\t\"<g transform='rotate(\"+angle+\")'>\"+\r\n\t\t\t\"<path d='M -1 1 V 0 A 1 1 0 0 1 1 0 V 1' fill='none' stroke='#000' stroke-width='0.25' />\"+\r\n\t\t\t\"<path d='M -1.4 0.25 L -1 1 L -0.6 0.25 L -1 1.25 Z' stroke='#000' stroke-width='0.15' />\"+\r\n\t\t\t\"<path d='M  1.4 0.25 L  1 1 L  0.6 0.25 L  1 1.25 Z' stroke='#000' stroke-width='0.15' />\"+\r\n\t\t\t\"</g>\"+\r\n\t\t\"</svg>\";\r\n\t}\r\n\tfunction drawDiagram() {\r\n\t\tfunction hr(h,s) { return s.replace(/h/g,h?'':'-'); }\r\n\t\tfunction vr(v,s) { return s.replace(/v/g,v?'':'-'); }\r\n\t\tvar lobe=rcDir?function(v,h){\r\n\t\t\treturn hr(h,vr(v,'M 0 0 V v2 C 0 v4 h4 v4 h5 v3 C h6 v2 h8 v2 h8 v4 C h8 v6 h6 v6 h5 v5 C h4 v4 0 v4 0 v6 V v8'));\r\n\t\t}:function(h,v){\r\n\t\t\treturn hr(h,vr(v,'M 0 0 H h4 C h6 0 h6 v2 h5 v3 C h4 v4 h4 v6 h6 v6 C h8 v6 h8 v4 h7 v3 C h6 v2 h6 0 h8 0 H h12'));\r\n\t\t};\r\n\t\tvar close=rcDir?function(h){\r\n\t\t\treturn hr(h,' H h12 V 0 Z');\r\n\t\t}:function(v){\r\n\t\t\treturn vr(v,' V v8 H 0 Z');\r\n\t\t};\r\n\t\tfunction tickPaths() {\r\n\t\t\tvar s=\"\";\r\n\t\t\tfor (var i=-5;i<=5;i++) {\r\n\t\t\t\ts+=\"<path d='M -0.25 \"+i+\" H 0.25' fill='none' stroke='#000' stroke-width='0.05' />\";\r\n\t\t\t}\r\n\t\t\treturn s;\r\n\t\t}\r\n\t\tvar textCoords=rcDir?function(h){\r\n\t\t\treturn hr(h,\"x='h9.35' y='0'\");\r\n\t\t}:function(v){\r\n\t\t\treturn vr(v,\"x='0' y='v7.5'\");\r\n\t\t}\r\n\t\treturn \"<svg class='diagram base' viewBox='-12 -8 24 16'>\"+\r\n\t\t\t\"<path class='actual-true' d='\"+lobe(rcOrd[1],!rcOrd[0])+close(rcOrd[0])+\"' />\"+\r\n\t\t\t\"<path class='actual-false' d='\"+lobe(rcOrd[1],!rcOrd[0])+close(!rcOrd[0])+\"' />\"+\r\n\t\t\t\"<path class='actual-true' d='\"+lobe(!rcOrd[1],rcOrd[0])+close(rcOrd[0])+\"' />\"+\r\n\t\t\t\"<path class='actual-false' d='\"+lobe(!rcOrd[1],rcOrd[0])+close(!rcOrd[0])+\"' />\"+\r\n\t\t\t\"<g transform='\"+(rcDir?\"matrix(0,1,1,0,0,0) \":\"\")+\"scale(\"+vr(!rcOrd[0],'1,v1')+\")'>\"+\r\n\t\t\t\"<path d='M 0 -6 V 6' fill='none' stroke-width='0.2' stroke='#000' />\"+ // axis\r\n\t\t\t\"<path d='M 0 -6 L -0.25 -5.75 L 0 -7 L 0.25 -5.75 Z' />\"+\r\n\t\t\ttickPaths()+\r\n\t\t\t\"<g class='threshold'>\"+\r\n\t\t\t\t\"<path class='predicted-true' d='M -12 -0.2 H 12' fill='none' stroke-width='0.2' />\"+\r\n\t\t\t\t\"<path d='M -12 0 H 12' fill='none' stroke-width='0.2' stroke='#000' />\"+\r\n\t\t\t\t\"<path class='predicted-false' d='M -12 0.2 H 12' fill='none' stroke-width='0.2' />\"+\r\n\t\t\t\"</g>\"+\r\n\t\t\t\"</g>\"+\r\n\t\t\"</svg>\"+\r\n\t\t\"<svg class='diagram labels' viewBox='-12 -8 24 16' pointer-events='none'>\"+\r\n\t\t\t\"<text class='higher-threshold' \"+textCoords(rcOrd[0])+\" text-anchor='middle' dy='.4em' font-size='0.7' font-family='sans-serif' pointer-events='all'>higher threshold</text>\"+\r\n\t\t\t\"<text class='lower-threshold' \"+textCoords(!rcOrd[0])+\" text-anchor='middle' dy='.4em' font-size='0.7' font-family='sans-serif' pointer-events='all'>lower threshold</text>\"+\r\n\t\t\"</svg>\";\r\n\t}\r\n\tfunction installDiagrammEventHandlers() {\r\n\t\tvar higherFormulaNodes=tableNode.find(\"td[data-term='TP'] .formula, td[data-term='FP'] .formula\");\r\n\t\tvar lowerFormulaNodes=tableNode.find(\"td[data-term='FN'] .formula, td[data-term='TN'] .formula\");\r\n\t\ttableNode.find('.diagram.labels .higher-threshold').hover(function(){\r\n\t\t\ttableNode.find('.diagram.base .threshold').attr('transform','translate(0,-3)');\r\n\t\t\thigherFormulaNodes.addClass('smaller');\r\n\t\t\tlowerFormulaNodes.addClass('larger');\r\n\t\t},function(){\r\n\t\t\ttableNode.find('.diagram.base .threshold').removeAttr('transform');\r\n\t\t\thigherFormulaNodes.removeClass('smaller');\r\n\t\t\tlowerFormulaNodes.removeClass('larger');\r\n\t\t});\r\n\t\ttableNode.find('.diagram.labels .lower-threshold').hover(function(){\r\n\t\t\ttableNode.find('.diagram.base .threshold').attr('transform','translate(0,3)');\r\n\t\t\thigherFormulaNodes.addClass('larger');\r\n\t\t\tlowerFormulaNodes.addClass('smaller');\r\n\t\t},function(){\r\n\t\t\ttableNode.find('.diagram.base .threshold').removeAttr('transform');\r\n\t\t\thigherFormulaNodes.removeClass('larger');\r\n\t\t\tlowerFormulaNodes.removeClass('smaller');\r\n\t\t});\r\n\t}\r\n\tfunction updateDiagram() {\r\n\t\ttableNode.find('.diagram.labels').remove();\r\n\t\ttableNode.find('.diagram').replaceWith(drawDiagram());\r\n\t\tinstallDiagrammEventHandlers();\r\n\t}\r\n\ttableNode.children('caption').append(drawDiagram()).append(\r\n\t\t$(\"<button type='button' class='swap-rc' title='swap rows and columns'>\"+drawSwapIcon(-45)+\"</button>\").click(function(){\r\n\t\t\trcDir^=1;\r\n\t\t\tupdateDiagram();\r\n\t\t\tvar n=tbodyNode.children().length;\r\n\t\t\tfor (var i=0;i<n;i++) {\r\n\t\t\t\tfor (var j=0;j<i;j++) {\r\n\t\t\t\t\tvar c1=tbodyNode.children().eq(i).children().eq(j);\r\n\t\t\t\t\tvar c2=tbodyNode.children().eq(j).children().eq(i);\r\n\t\t\t\t\tvar c2p=c2.prev();\r\n\t\t\t\t\tc1.after(c2);\r\n\t\t\t\t\tc2p.after(c1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t).append(\r\n\t\t$(\"<button type='button' class='swap-c' title='swap columns'>\"+drawSwapIcon(0)+\"</button>\").click(function(){\r\n\t\t\trcOrd[rcDir^1]^=1;\r\n\t\t\tupdateDiagram();\r\n\t\t\ttbodyNode.children().each(function(){\r\n\t\t\t\tswapChildren($(this),1);\r\n\t\t\t\tif (!isExpanded) return;\r\n\t\t\t\tswapChildren($(this),3);\r\n\t\t\t});\r\n\t\t})\r\n\t).append(\r\n\t\t$(\"<button type='button' class='add-c' title='expand table'>+</button>\").click(expandTable)\r\n\t).append(\r\n\t\t$(\"<button type='button' class='swap-r' title='swap rows'>\"+drawSwapIcon(-90)+\"</button>\").click(function(){\r\n\t\t\trcOrd[rcDir]^=1;\r\n\t\t\tupdateDiagram();\r\n\t\t\tswapChildren(tbodyNode,1);\r\n\t\t\tif (!isExpanded) return;\r\n\t\t\tswapChildren(tbodyNode,3);\r\n\t\t})\r\n\t).append(\r\n\t\t$(\"<button type='button' class='add-r' title='expand table'>+</button>\").click(expandTable)\r\n\t);\r\n\tinstallDiagrammEventHandlers();\r\n\ttableNode.on('mouseenter','.term',function(){\r\n\t\t$(this).addClass('highlight');\r\n\t\ttableNode.find(\"td[data-term='\"+$(this).attr('data-term')+\"']\").addClass('highlight');\r\n\t}).on('mouseleave','.term',function(){\r\n\t\ttableNode.find(\"td[data-term='\"+$(this).attr('data-term')+\"']\").removeClass('highlight');\r\n\t\t$(this).removeClass('highlight');\r\n\t});\r\n\r\n\t// number inputs\r\n\tvar termInputs={\r\n\t\t'TP':false,\r\n\t\t'FP':false,\r\n\t\t'FN':false,\r\n\t\t'TN':false\r\n\t};\r\n\t// number input values as strings\r\n\tvar termValues={\r\n\t\t'TP':'0',\r\n\t\t'FP':'0',\r\n\t\t'FN':'0',\r\n\t\t'TN':'0'\r\n\t};\r\n\tfunction updateFormulas() {\r\n\t\t// entered numbers\r\n\t\tvar subs={};\r\n\t\tfor (term in termInputs) {\r\n\t\t\tif (termInputs[term]) {\r\n\t\t\t\tsubs[term]=makeNumber(termValues[term]);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// hack for DLR\r\n\t\tif ('TP' in subs && 'FN' in subs) {\r\n\t\t\tsubs.TPR=makeFraction(makeNumber(termValues.TP),makeSum([makeNumber(termValues.TP),makeNumber(termValues.FN)]));\r\n\t\t\tsubs.FNR=makeFraction(makeNumber(termValues.FN),makeSum([makeNumber(termValues.TP),makeNumber(termValues.FN)]));\r\n\t\t}\r\n\t\tif ('FP' in subs && 'TN' in subs) {\r\n\t\t\tsubs.FPR=makeFraction(makeNumber(termValues.FP),makeSum([makeNumber(termValues.FP),makeNumber(termValues.TN)]));\r\n\t\t\tsubs.TNR=makeFraction(makeNumber(termValues.TN),makeSum([makeNumber(termValues.FP),makeNumber(termValues.TN)]));\r\n\t\t}\r\n\t\t// update html\r\n\t\ttableNode.find('.formula').each(function(){\r\n\t\t\tvar formula=$(this);\r\n\t\t\tformula.html(convertExpressionToHtml(substituteIntoExpression(parseExpression(formula.attr('data-formula')),subs)));\r\n\t\t});\r\n\t}\r\n\t$.each(termInputs,function(term){\r\n\t\tvar td=tableNode.find(\"td[data-term='\"+term+\"']\");\r\n\t\ttd.append(\r\n\t\t\t$(\"<div class='buttons' />\").append(\r\n\t\t\t\t$(\"<input type='button' value='Set number' />\").click(function(){\r\n\t\t\t\t\tif (!termInputs[term]) {\r\n\t\t\t\t\t\ttermInputs[term]=true;\r\n\t\t\t\t\t\tvar fi=td.children('.formula');\r\n\t\t\t\t\t\tfi.attr('class','input').html(\r\n\t\t\t\t\t\t\t\"<label>\"+\r\n\t\t\t\t\t\t\t\t\"<span class='aux'>\"+td.children('.label').eq(0).text()+\"</span> \"+\r\n\t\t\t\t\t\t\t\t\"<input type='number' min='0' value='\"+termValues[term]+\"' required />\"+\r\n\t\t\t\t\t\t\t\"</label>\"+\r\n\t\t\t\t\t\t\t\"<span class='aux'>, current value:</span> <output>\"+termValues[term]+\"</output>\"\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tfi.find('input').on('input',function(){\r\n\t\t\t\t\t\t\tif (this.validity.valid) {\r\n\t\t\t\t\t\t\t\ttermValues[term]=this.value;\r\n\t\t\t\t\t\t\t\tfi.find('output').text(termValues[term]);\r\n\t\t\t\t\t\t\t\tupdateFormulas();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t$(this).val('Remove number');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttermInputs[term]=false;\r\n\t\t\t\t\t\ttd.children('.input').attr('class','formula').html(convertExpressionToHtml(makeSymbol(term)));\r\n\t\t\t\t\t\t$(this).val('Set number');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tupdateFormulas();\r\n\t\t\t\t})\r\n\t\t\t)\r\n\t\t);\r\n\t});\r\n});\r\n"],"sourceRoot":"/source/"}
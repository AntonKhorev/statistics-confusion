{"version":3,"sources":["intro.js","util.js","main.js"],"names":["$","makeFormulaSubstitutions","formula","subs","expr","stripParentheses","charAt","slice","match","type","num","den","terms","split","root","lhs","rhs","synth","node","numericFraction","gcd","a","b","toFixed","value","precision","power","Math","pow","String","round","n","parseInt","d","g","indexOf","nMatches","sum","forEach","term","map","join","length","filter","tree","makeFormulaHtml","replace","p1","p2","e","vis","makeEmptyFormulaHtml","each","wikipedia","block","url","haveToSwap","dir","i","rcOrd","rcDir","expandTable","addCell","callOrd","insertNormal","insertSwapped","makeCell","j","cellData","expandData","cell","html","attr","addCol","tbodyNode","children","oldRow","this","newCell","append","eq","before","addRow","newRow","oldCell","isExpanded","tableNode","find","text","off","click","contractTable","updateFormulas","removeCol","remove","removeRow","after","swapChildren","c1","c2","drawSwapIcon","angle","termInputs","termValues","c2p","prev","on","addClass","removeClass","TP","FP","FN","TN","td","val","fi","validity","valid"],"mappings":"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","file":"index.js","sourcesContent":["$(function(){\r\n","function makeFormulaSubstitutions(formula,subs) {\r\n\t// parse\r\n\tfunction expr(formula) {\r\n\t\tfunction stripParentheses(formula) {\r\n\t\t\tif (formula.charAt(0)=='(') {\r\n\t\t\t\treturn formula.slice(1,-1);\r\n\t\t\t} else {\r\n\t\t\t\treturn formula;\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar match=formula.match(/(\\(.*\\)|\\w+)\\/(\\(.*\\)|\\w+)/);\r\n\t\tif (match) {\r\n\t\t\treturn {\r\n\t\t\t\ttype:'frac',\r\n\t\t\t\tnum:expr(stripParentheses(match[1])),\r\n\t\t\t\tden:expr(stripParentheses(match[2]))\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn {\r\n\t\t\t\ttype:'sum',\r\n\t\t\t\tterms:formula.split('+')\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tfunction root(formula) {\r\n\t\tvar match=formula.match(/^(.*)=(.*)$/);\r\n\t\tif (match) {\r\n\t\t\treturn {\r\n\t\t\t\ttype:'def',\r\n\t\t\t\tlhs:match[1],\r\n\t\t\t\trhs:expr(match[2])\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\treturn expr(formula);\r\n\t\t}\r\n\t}\r\n\tvar tree=root(formula);\r\n\r\n\t// substitute\r\n\tfunction synth(node) {\r\n\t\tfunction numericFraction(num,den) {\r\n\t\t\tfunction gcd(a,b) {\r\n\t\t\t\tif (!b) {\r\n\t\t\t\t\treturn a;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn gcd(b,a%b);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\t// http://stackoverflow.com/a/661757\r\n\t\t\tfunction toFixed(value,precision) {\r\n\t\t\t\tvar power=Math.pow(10,precision||0);\r\n\t\t\t\treturn String(Math.round(value*power)/power);\r\n\t\t\t}\r\n\t\t\tvar n=parseInt(num);\r\n\t\t\tvar d=parseInt(den);\r\n\t\t\tif (d==0) {\r\n\t\t\t\treturn ''+n+'/0';\r\n\t\t\t}\r\n\t\t\tvar g=gcd(n,d);\r\n\t\t\tif (parseInt(d/g)==1) {\r\n\t\t\t\treturn ''+parseInt(n/g);\r\n\t\t\t} else {\r\n\t\t\t\treturn ''+parseInt(n/g)+'/'+parseInt(d/g)+'='+toFixed(n/d,6);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (node.type=='def') {\r\n\t\t\treturn node.lhs+'='+synth(node.rhs);\r\n\t\t} else if (node.type=='frac') {\r\n\t\t\tvar num=synth(node.num);\r\n\t\t\tvar den=synth(node.den);\r\n\t\t\tif (num.indexOf('+')>=0) num='('+num+')';\r\n\t\t\tif (den.indexOf('+')>=0) den='('+den+')';\r\n\t\t\tif (num.match(/^\\d+$/) && den.match(/^\\d+$/)) {\r\n\t\t\t\treturn numericFraction(num,den);\r\n\t\t\t} else {\r\n\t\t\t\treturn num+'/'+den;\r\n\t\t\t}\r\n\t\t} else if (node.type=='sum') {\r\n\t\t\tvar nMatches=0;\r\n\t\t\tvar sum=0;\r\n\t\t\tnode.terms.forEach(function(term){\r\n\t\t\t\tif (term in subs) {\r\n\t\t\t\t\tnMatches++;\r\n\t\t\t\t\tsum+=subs[term];\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (nMatches<=1) {\r\n\t\t\t\treturn node.terms.map(function(term){\r\n\t\t\t\t\treturn (term in subs) ? subs[term] : term;\r\n\t\t\t\t}).join('+');\r\n\t\t\t} else if (nMatches<node.terms.length) {\r\n\t\t\t\treturn node.terms.filter(function(term){\r\n\t\t\t\t\treturn !(term in subs)\r\n\t\t\t\t}).join('+')+'+'+sum;\r\n\t\t\t} else {\r\n\t\t\t\treturn ''+sum;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn synth(tree);\r\n}\r\n\r\nfunction makeFormulaHtml(formula) {\r\n\treturn formula\r\n\t\t.replace(/=/g,' = ')\r\n\t\t.replace(/(\\(.*\\)|\\w+)\\/(\\(.*\\)|\\w+)/,function(match,p1,p2){\r\n\t\t\tfunction e(formula) {\r\n\t\t\t\tif (formula.charAt(0)=='(') {\r\n\t\t\t\t\treturn \"<span class='aux'>(</span>\"+formula.slice(1,-1)+\"<span class='aux'>)</span>\";\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn formula;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn \"<span class='sfrac'>\"+\r\n\t\t\t\t\"<span class='num'>\"+e(p1)+\"</span>\"+\r\n\t\t\t\t\"<span class='aux'>/</span>\"+\r\n\t\t\t\t\"<span class='den'>\"+e(p2)+\"</span>\"+\r\n\t\t\t\"</span>\";\r\n\t\t})\r\n\t\t.replace(/\\b[A-Z]+\\b/g,function(match){\r\n\t\t\tvar vis=match;\r\n\t\t\tif (match=='PLR') {\r\n\t\t\t\tvis=\"LR<sub>+</sub>\";\r\n\t\t\t} else if (match=='NLR') {\r\n\t\t\t\tvis=\"LR<sub>−</sub>\";\r\n\t\t\t}\r\n\t\t\treturn \"<span class='term' data-term='\"+match+\"'>\"+vis+\"</span>\";\r\n\t\t})\r\n\t;\r\n}\r\n\r\nfunction makeWrappedFormulaHtml(formula) {\r\n\treturn \"<div class='formula' data-formula='\"+formula+\"'>\"+makeFormulaHtml(formula)+\"</div>\";\r\n}\r\n\r\nfunction makeEmptyFormulaHtml(formula) {\r\n\treturn \"<div class='formula' data-formula='\"+formula+\"' />\";\r\n}\r\n","$('table.statistics-confusion').each(function(){\r\n\tvar tableNode=$(this);\r\n\tvar tbodyNode=tableNode.children('tbody');\r\n\tvar rcDir=0; // outcome headers on top?\r\n\tvar rcOrd=[0,0]; // outcomes swapped?, conditions swapped?\r\n\tvar isExpanded=false;\r\n\t//function wikipedia(block,url) {\r\n\t//\tif (url===undefined) url=\"https://en.wikipedia.org/wiki/\"+block.replace(/ /g,'_');\r\n\tfunction wikipedia(block) {\r\n\t\turl=\"https://en.wikipedia.org/wiki/\"+block.replace(/ /g,'_');\r\n\t\treturn \"<a href='\"+url+\"'>\"+block+\"</a>\";\r\n\t}\r\n\tvar expandData=[\r\n\t\t[ // new row\r\n\t\t\t[null,makeEmptyFormulaHtml(\"(FN+TN)/(TP+FP+FN+TN)\")],\r\n\t\t\t['FNR',\"<div class='label'>\"+wikipedia(\"False negative rate\")+\"</div>\"+makeEmptyFormulaHtml(\"FNR=FN/(TP+FN)\")],\r\n\t\t\t['FPR',\"<div class='label'>\"+wikipedia(\"False positive rate\")+\"</div>\"+makeEmptyFormulaHtml(\"FPR=FP/(FP+TN)\")],\r\n\t\t\t[null,\"<div class='label'>Overall error rate</div>\"+makeEmptyFormulaHtml(\"(FP+FN)/(TP+FP+FN+TN)\")],\r\n\t\t\t[null,\"\"] // not used\r\n\t\t],[ // new col\r\n\t\t\t[null,makeEmptyFormulaHtml(\"(FP+TN)/(TP+FP+FN+TN)\")],\r\n\t\t\t['FDR',\"<div class='label'>\"+wikipedia(\"False discovery rate\")+\"</div>\"+makeEmptyFormulaHtml(\"FDR=FP/(TP+FP)\")],\r\n\t\t\t['FOR',\"<div class='label'>\"+wikipedia(\"False omission rate\")+\"</div>\"+makeEmptyFormulaHtml(\"FOR=FN/(FN+TN)\")],\r\n\t\t\t['PLR',\"<div class='label'>\"+wikipedia(\"Positive likelihood ratio\")+\"</div>\"+makeEmptyFormulaHtml(\"PLR=TPR/FPR\")],\r\n\t\t\t['NLR',\"<div class='label'>\"+wikipedia(\"Negative likelihood ratio\")+\"</div>\"+makeEmptyFormulaHtml(\"NLR=FNR/TNR\")]\r\n\t\t]\r\n\t];\r\n\tfunction haveToSwap(dir,i) {\r\n\t\tif (i==1 || i==2) {\r\n\t\t\treturn ((i-1)^rcOrd[0]^rcOrd[1])&1;\r\n\t\t} else {\r\n\t\t\treturn rcOrd[rcDir^dir]&1;\r\n\t\t}\r\n\t}\r\n\tfunction expandTable() {\r\n\t\tfunction addCell(callOrd,dir,i,insertNormal,insertSwapped) {\r\n\t\t\tfunction makeCell() {\r\n\t\t\t\tvar j=i;\r\n\t\t\t\tif ((j==1 || j==2) && rcOrd[rcDir^dir^1]) {\r\n\t\t\t\t\tj^=1^2;\r\n\t\t\t\t} else if (callOrd && (j==3 || j==4) && rcOrd[rcDir^dir^1]) {\r\n\t\t\t\t\tj^=3^4;\r\n\t\t\t\t}\r\n\t\t\t\tvar cellData=expandData[rcDir^dir][j];\r\n\t\t\t\tvar cell=$(\"<td>\").html(cellData[1]);\r\n\t\t\t\tif (cellData[0]!==null) cell.attr('data-term',cellData[0]);\r\n\t\t\t\treturn cell;\r\n\t\t\t}\r\n\t\t\tvar cell=makeCell();\r\n\t\t\tif (haveToSwap(dir,i)) {\r\n\t\t\t\tinsertSwapped(cell);\r\n\t\t\t} else {\r\n\t\t\t\tinsertNormal(cell);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction addCol(callOrd) {\r\n\t\t\ttbodyNode.children().each(function(i){\r\n\t\t\t\tvar oldRow=$(this);\r\n\t\t\t\taddCell(callOrd,1,i,function(newCell){\r\n\t\t\t\t\toldRow.append(newCell);\r\n\t\t\t\t},function(newCell){\r\n\t\t\t\t\toldRow.children().eq(-1).before(newCell);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t\tfunction addRow(callOrd) {\r\n\t\t\tvar newRow=$(\"<tr>\");\r\n\t\t\ttbodyNode.append(newRow);\r\n\t\t\ttbodyNode.children().eq(-2).children().each(function(i){\r\n\t\t\t\tvar oldCell=$(this);\r\n\t\t\t\taddCell(callOrd,0,i,function(newCell){\r\n\t\t\t\t\tnewRow.append(newCell);\r\n\t\t\t\t},function(newCell){\r\n\t\t\t\t\toldCell.before(newCell);\r\n\t\t\t\t\tnewRow.append(oldCell);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t\tif (rcDir) {\r\n\t\t\taddCol(0);\r\n\t\t\taddRow(1);\r\n\t\t} else {\r\n\t\t\taddRow(0);\r\n\t\t\taddCol(1);\r\n\t\t}\r\n\t\tisExpanded=true;\r\n\t\ttableNode.find('button.add-r, button.add-c').text('−').attr('title','contract table').off().click(contractTable);\r\n\t\tupdateFormulas();\r\n\t}\r\n\tfunction contractTable() {\r\n\t\tfunction removeCol() {\r\n\t\t\ttbodyNode.children().each(function(i){\r\n\t\t\t\tvar oldRow=$(this);\r\n\t\t\t\toldRow.children().eq(haveToSwap(1,i)?-2:-1).remove();\r\n\t\t\t});\r\n\t\t}\r\n\t\tfunction removeRow() {\r\n\t\t\tvar oldRow=tbodyNode.children().eq(-2);\r\n\t\t\tvar newRow=tbodyNode.children().eq(-1);\r\n\t\t\tnewRow.children().each(function(i){\r\n\t\t\t\tif (haveToSwap(0,i)) {\r\n\t\t\t\t\tvar oldCell=$(this);\r\n\t\t\t\t\tvar newCell=oldRow.children().eq(i);\r\n\t\t\t\t\tnewCell.after(oldCell).remove();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tnewRow.remove();\r\n\t\t}\r\n\t\tif (rcDir) {\r\n\t\t\tremoveRow();\r\n\t\t\tremoveCol();\r\n\t\t} else {\r\n\t\t\tremoveCol();\r\n\t\t\tremoveRow();\r\n\t\t}\r\n\t\tisExpanded=false;\r\n\t\ttableNode.find('button.add-r, button.add-c').text('+').attr('title','expand table').off().click(expandTable);\r\n\t}\r\n\tfunction swapChildren(node,i) {\r\n\t\tvar c1=node.children().eq(i);\r\n\t\tvar c2=node.children().eq(i+1);\r\n\t\tc1.before(c2);\r\n\t}\r\n\tfunction drawSwapIcon(angle) {\r\n\t\treturn \"<svg width='100%' height='100%' viewBox='-2 -2 4 4'>\"+\r\n\t\t\t\"<g transform='rotate(\"+angle+\")'>\"+\r\n\t\t\t\"<path d='M -1 1 V 0 A 1 1 0 0 1 1 0 V 1' fill='none' stroke='#000' stroke-width='0.25' />\"+\r\n\t\t\t\"<path d='M -1.4 0.25 L -1 1 L -0.6 0.25 L -1 1.25 Z' stroke='#000' stroke-width='0.15' />\"+\r\n\t\t\t\"<path d='M  1.4 0.25 L  1 1 L  0.6 0.25 L  1 1.25 Z' stroke='#000' stroke-width='0.15' />\"+\r\n\t\t\t\"</g>\"+\r\n\t\t\"</svg>\";\r\n\t}\r\n\ttableNode.children('caption').append(\r\n\t\t$(\"<button type='button' class='swap-rc' title='swap rows and columns'>\"+drawSwapIcon(-45)+\"</button>\").click(function(){\r\n\t\t\trcDir^=1;\r\n\t\t\tvar n=tbodyNode.children().length;\r\n\t\t\tfor (var i=0;i<n;i++) {\r\n\t\t\t\tfor (var j=0;j<i;j++) {\r\n\t\t\t\t\tvar c1=tbodyNode.children().eq(i).children().eq(j);\r\n\t\t\t\t\tvar c2=tbodyNode.children().eq(j).children().eq(i);\r\n\t\t\t\t\tvar c2p=c2.prev();\r\n\t\t\t\t\tc1.after(c2);\r\n\t\t\t\t\tc2p.after(c1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t})\r\n\t).append(\r\n\t\t$(\"<button type='button' class='swap-c' title='swap columns'>\"+drawSwapIcon(0)+\"</button>\").click(function(){\r\n\t\t\trcOrd[rcDir^1]^=1;\r\n\t\t\ttbodyNode.children().each(function(){\r\n\t\t\t\tswapChildren($(this),1);\r\n\t\t\t\tif (!isExpanded) return;\r\n\t\t\t\tswapChildren($(this),3);\r\n\t\t\t});\r\n\t\t})\r\n\t).append(\r\n\t\t$(\"<button type='button' class='add-c' title='expand table'>+</button>\").click(expandTable)\r\n\t).append(\r\n\t\t$(\"<button type='button' class='swap-r' title='swap rows'>\"+drawSwapIcon(-90)+\"</button>\").click(function(){\r\n\t\t\trcOrd[rcDir]^=1;\r\n\t\t\tswapChildren(tbodyNode,1);\r\n\t\t\tif (!isExpanded) return;\r\n\t\t\tswapChildren(tbodyNode,3);\r\n\t\t})\r\n\t).append(\r\n\t\t$(\"<button type='button' class='add-r' title='expand table'>+</button>\").click(expandTable)\r\n\t);\r\n\ttableNode.on('mouseenter','.term',function(){\r\n\t\t$(this).addClass('highlight');\r\n\t\ttableNode.find(\"td[data-term='\"+$(this).attr('data-term')+\"']\").addClass('highlight');\r\n\t}).on('mouseleave','.term',function(){\r\n\t\ttableNode.find(\"td[data-term='\"+$(this).attr('data-term')+\"']\").removeClass('highlight');\r\n\t\t$(this).removeClass('highlight');\r\n\t});\r\n\r\n\t// number inputs\r\n\tvar termInputs={\r\n\t\t'TP':false,\r\n\t\t'FP':false,\r\n\t\t'FN':false,\r\n\t\t'TN':false\r\n\t};\r\n\tvar termValues={\r\n\t\t'TP':0,\r\n\t\t'FP':0,\r\n\t\t'FN':0,\r\n\t\t'TN':0\r\n\t};\r\n\tfunction updateFormulas() {\r\n\t\tvar subs={};\r\n\t\tfor (term in termInputs) {\r\n\t\t\tif (termInputs[term]) {\r\n\t\t\t\tsubs[term]=termValues[term];\r\n\t\t\t}\r\n\t\t}\r\n\t\ttableNode.find('.formula').each(function(){\r\n\t\t\tvar formula=$(this);\r\n\t\t\tformula.html(makeFormulaHtml(makeFormulaSubstitutions(formula.attr('data-formula'),subs)));\r\n\t\t});\r\n\t}\r\n\t$.each(termInputs,function(term){\r\n\t\tvar td=tableNode.find(\"td[data-term='\"+term+\"']\");\r\n\t\ttd.append(\r\n\t\t\t$(\"<div class='buttons' />\").append(\r\n\t\t\t\t$(\"<input type='button' value='Set number' />\").click(function(){\r\n\t\t\t\t\tif (!termInputs[term]) {\r\n\t\t\t\t\t\ttermInputs[term]=true;\r\n\t\t\t\t\t\tvar fi=td.children('.formula');\r\n\t\t\t\t\t\tfi.attr('class','input').html(\r\n\t\t\t\t\t\t\t\"<label>\"+\r\n\t\t\t\t\t\t\t\t\"<span class='aux'>\"+td.children('.label').eq(0).text()+\"</span> \"+\r\n\t\t\t\t\t\t\t\t\"<input type='number' min='0' value='\"+termValues[term]+\"' required />\"+\r\n\t\t\t\t\t\t\t\"</label>\"+\r\n\t\t\t\t\t\t\t\"<span class='aux'>, current value:</span> <output>\"+termValues[term]+\"</output>\"\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tfi.find('input').on('input',function(){\r\n\t\t\t\t\t\t\tif (this.validity.valid) {\r\n\t\t\t\t\t\t\t\t//termValues[term]=this.valueAsNumber; // doesn't work in IE\r\n\t\t\t\t\t\t\t\ttermValues[term]=parseInt(this.value);\r\n\t\t\t\t\t\t\t\tfi.find('output').text(termValues[term]);\r\n\t\t\t\t\t\t\t\tupdateFormulas();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t$(this).val('Remove number');\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttermInputs[term]=false;\r\n\t\t\t\t\t\ttd.children('.input').attr('class','formula').html(makeFormulaHtml(term));\r\n\t\t\t\t\t\t$(this).val('Set number');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tupdateFormulas();\r\n\t\t\t\t})\r\n\t\t\t)\r\n\t\t);\r\n\t});\r\n});\r\n"],"sourceRoot":"/source/"}